version: "3.8"

services:
  # ===== 개발 모드: Vite dev server + HMR =====
  # 사용법: docker compose up dev
  dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: realtyflow-dev
    ports:
      - "3000:3000"
    volumes:
      # 소스코드 마운트 (NAS에서 파일 수정 → 즉시 반영)
      - .:/app
      # node_modules는 컨테이너 내부 것 사용 (호스트와 격리)
      - /app/node_modules
    environment:
      - CHOKIDAR_USEPOLLING=true      # NAS 파일시스템 호환 (파일 변경 감지)
      - WATCHPACK_POLLING=true          # webpack/vite 폴링 모드
    restart: unless-stopped

  # ===== 프로덕션 모드: nginx 정적 서빙 =====
  # 사용법: docker compose up prod
  prod:
    build: .
    container_name: realtyflow
    ports:
      - "8847:80"
    restart: unless-stopped
